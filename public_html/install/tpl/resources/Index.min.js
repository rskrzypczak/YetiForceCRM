'use strict';

jQuery.Class('Install_Index_Js',{fieldsCached:['db_hostname','db_username','db_name','create_db','db_root_username','currency_name','firstname','lastname','admin_email','dateformat','timezone'],checkUsername:function c(a){var b=JSON.parse(jQuery('#not_allowed_logins').val());if(-1!==jQuery.inArray(a.val(),b))return app.vtranslate('LBL_INVALID_USERNAME_ERROR')}},{registerEventForStep1:function a(){jQuery('.bt_install').on('click',function(){jQuery('input[name="mode"]').val('step2'),jQuery('form[name="step1"]').submit();}),jQuery('.bt_migrate').on('click',function(){jQuery('input[name="mode"]').val('mStep0'),jQuery('form[name="step1"]').submit();});},registerEventForStep3:function a(){jQuery('#recheck').on('click',function(){window.location.reload();}),jQuery('input[name="step4"]').on('click',function(){var a=jQuery('.no');if(0<a.length){var b=app.vtranslate('LBL_PHP_WARNING');return !!confirm(b)&&(jQuery('form[name="step3"]').submit(),!0)}jQuery('form[name="step3"]').submit();});},checkPwdEvent:function b(){var a=this;jQuery('input[name="password"]').on('blur',function(){a.checkPwd(jQuery(this).val());});},checkPwd:function c(a){var b=!1;return 8>a.length?(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_TO_SHORT')),b=!0):32<a.length?(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_TO_LONG')),b=!0):-1==a.search(/\d/)?(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_NO_NUM')),b=!0):-1==a.search(/[A-Z]/)?(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_LACK_OF_CAPITAL_LETTERS')),b=!0):-1==a.search(/[a-z]/)&&(jQuery('#passwordError').html(app.vtranslate('LBL_PASS_LACK_OF_LOWERCASE_LETTERS')),b=!0),b},registerEventForStep4:function e(){function a(){jQuery('#passwordError').html('');}function b(){jQuery('#passwordError').html(app.vtranslate('LBL_PASS_REENTER_ERROR'));}var c=JSON.parse(localStorage.getItem('yetiforce_install'));Install_Index_Js.fieldsCached.forEach(function(a){if(c&&'undefined'!=typeof c[a]){var b=jQuery('[name="'+a+'"]');'SELECT'==jQuery(b).prop('tagName')?(jQuery(b).val(c[a]),jQuery(b).select2('destroy'),App.Fields.Picklist.showSelect2ElementView(jQuery(b))):'INPUT'==jQuery(b).prop('tagName')&&'checkbox'==jQuery(b).attr('type')?!0==c[a]&&(jQuery(b).prop('checked',!0),jQuery('.config-table tr.d-none').removeClass('d-none')):jQuery(b).val(c[a]);}});var d=this;jQuery('input[name="create_db"]').on('click',function(){var a=jQuery('#root_user'),b=jQuery('#root_password');jQuery(this).is(':checked')?(a.removeClass('d-none'),b.removeClass('d-none')):(a.addClass('d-none'),b.addClass('d-none'));}),jQuery('input[name="retype_password"]').on('blur',function(a){var c=jQuery(a.currentTarget),d=jQuery('input[name="password"]').val();d!==c.val()&&b();}),jQuery('input[name="password"]').on('blur',function(b){var c=jQuery('input[name="retype_password"]');''!=c.val()&&c.val()!==jQuery(b.currentTarget).val()?jQuery('#passwordError').html(app.vtranslate('LBL_PASS_REENTER_ERROR')):a();}),jQuery('input[name="retype_password"]').on('keypress',function(){a();}),jQuery('input[name="step5"]').on('click',function(){var a=!1,b=['db_hostname','db_username','db_name','password','retype_password','lastname','admin_email'];for(var c in b){var e=jQuery('input[name="'+b[c]+'"]');if(''==e.val()){e.addClass('error').focus(),a=!0;break}else e.removeClass('error');}var f=jQuery('input[name="create_db"]:checked');if(0<f.length){var g=jQuery('input[name="db_root_username"]');''==g.val()?(g.addClass('error').focus(),a=!0):g.removeClass('error');}var h=jQuery('#passwordError');h.html().trim()&&(a=!0);var i=jQuery('input[name="admin_email"]'),j=!1,k=/^[_/a-zA-Z0-9*]+([!"#$%&'()*+,./:;<=>?\^_`{|}~-]?[a-zA-Z0-9/_/-])*@[a-zA-Z0-9]+([\_\-\.]?[a-zA-Z0-9]+)*\.([\-\_]?[a-zA-Z0-9])+(\.?[a-zA-Z0-9]+)?$/;k.test(i.val())||''==i.val()?i.removeClass('error'):(j=!0,i.addClass('error').focus(),a=!0);var l=!1;if(l=d.checkPwd(jQuery('input[name="password"]').val()),l&&(a=!0),a){var m;m=j?'<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+jQuery('[name="invalidEmailError"]').val()+'</div></div>':l?'<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+jQuery('[name="insufficientlyStrongPassword"]').val()+'</div></div>':'<div class="span12"><div class="alert alert-error"><button class="close" data-dismiss="alert" type="button">x</button>'+app.vtranslate('LBL_MANDATORY_FIELDS_ERROR')+'</div></div>',jQuery('#errorMessage').html(m).show();}else{var n={db_hostname:document.step4.db_hostname.value,db_username:document.step4.db_username.value,db_name:document.step4.db_name.value,create_db:jQuery('[name="create_db"]').prop('checked'),db_root_username:document.step4.db_root_username.value,currency_name:document.step4.currency_name.value,firstname:document.step4.firstname.value,lastname:document.step4.lastname.value,admin_email:document.step4.admin_email.value,dateformat:document.step4.dateformat.value,timezone:document.step4.timezone.value};window.localStorage.setItem('yetiforce_install',JSON.stringify(n)),jQuery('form[name="step4"]').submit();}}),this.checkPwdEvent();},registerEventForStep5:function a(){jQuery('input[name="step6"]').on('click',function(){var a=jQuery('#errorMessage');return a.length?(alert(app.vtranslate('LBL_RESOLVE_ERROR')),!1):void(jQuery('#progressIndicator').removeClass('d-none'),jQuery('form[name="step5"]').submit().hide())});},registerEventForStep6:function a(){jQuery('input[name="step7"]').on('click',function(){$('form[name="step6"]').validationEngine('validate')&&(jQuery('#progressIndicator').show().removeClass('d-none'),jQuery('form[name="step6"]').submit().parent().hide());});},registerEventForMigration:function b(){var a=jQuery('input[name="mode"]').val();'mStep3'==a&&jQuery('form').on('submit',function(){jQuery('#progressIndicator').show(),jQuery('#mainContainer').hide();});},changeLanguage:function b(a){$(a.currentTarget);jQuery('input[name="mode"]').val('step1'),jQuery('form[name="step1"]').submit();},registerEvents:function a(){jQuery('input[name="back"]').on('click',function(){var a=jQuery('input[name="create_db"]:checked');0<a.length&&jQuery('input[name="create_db"]').removeAttr('checked'),window.history.back();}),jQuery('form').validationEngine(app.validationEngineOptions),this.registerEventForStep1(),this.registerEventForStep3(),this.registerEventForStep4(),this.registerEventForStep5(),this.registerEventForStep6(),this.registerEventForMigration(),$('select[name="lang"]').on('change',this.changeLanguage);}}),jQuery(document).ready(function(){var a=new Install_Index_Js;a.registerEvents();});
