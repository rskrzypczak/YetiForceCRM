'use strict';

var Settings_Index_Js={updatedBlockFieldsList:[],initEvants:function a(){$('.SearchFieldsEdit .fieldname').on('change',Settings_Index_Js.save),$('.SearchFieldsEdit .searchcolumn').on('change',Settings_Index_Js.save),$('.SearchFieldsEdit .updateLabels').on('click',Settings_Index_Js.updateLabels),$('.SearchFieldsEdit .editLabels').on('click',Settings_Index_Js.editLabels),$('.SearchFieldsEdit .turn_off').on('click',Settings_Index_Js.replacement);},replacement:function c(a){var b=$(a.currentTarget);parseInt(b.val())?b.val(0).html('<span class="fas fa-power-off u-mr-5px"></span>'+app.vtranslate('JS_TURN_ON')):b.val(1).html('<span class="fas fa-power-off u-mr-5px"></span>'+app.vtranslate('JS_TURN_OFF')),b.toggleClass('btn-success btn-danger'),Settings_Index_Js.save(a);},updateLabels:function d(a){var b=$(a.currentTarget),c=b.closest('tr');c.hasClass('ui-sortable-handle')||(c=c.prev()),Settings_Index_Js.registerSaveEvent('updateLabels',{tabid:c.data('tabid')});},editLabels:function f(a){var b=$(a.currentTarget),c=b.data('tabid'),d=b.closest('tr');jQuery('.elementLabels'+c).addClass('d-none'),a=jQuery('.elementEdit'+c).removeClass('d-none'),Settings_Index_Js.registerSelectElement(a.find('select'));},save:function c(a){var b=$(a.currentTarget);Settings_Index_Js.registerSaveEvent('save',{name:b.attr('name'),value:b.val(),tabid:b.data('tabid')});},registerSaveEvent:function f(a,b){var c=$.progressIndicator({message:app.vtranslate('Saving changes'),position:'html',blockInfo:{enabled:!0}}),d='',e={};e.data={module:app.getModuleName(),parent:app.getParentModuleName(),action:'SaveAjax',mode:a,params:b},e.async=!1,e.dataType='json',AppConnector.request(e).done(function(a){var b=a.result,e={text:b.message,type:'success'};Vtiger_Helper_Js.showPnotify(e),d=b.success,c.progressIndicator({mode:'hide'});}).fail(function(){c.progressIndicator({mode:'hide'});});},makeFieldsListSortable:function d(){var a=this,b=jQuery('.SearchFieldsEdit').find('.contents'),c=b.find('table');c.each(function(){jQuery(this).find('tbody').sortable({containment:'#modulesEntity',revert:!0,tolerance:'pointer',cursor:'move',helper:function c(a,b){return b.children().each(function(a,b){b=jQuery(b),b.width(b.width());}),b},update:function b(){a.showSaveModuleSequenceButton();}});});},showSaveModuleSequenceButton:function d(){var a=this,b=jQuery('.SearchFieldsEdit'),c=b.find('.saveModuleSequence');a.updatedBlockFieldsList=[],c.removeClass('d-none');},hideSaveModuleSequenceButton:function c(){var a=jQuery('.SearchFieldsEdit'),b=a.find('.saveModuleSequence');b.addClass('d-none');},updateModulesSequence:function d(){var a=this,b=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),c={};c.module=app.getModuleName(),c.parent=app.getParentModuleName(),c.action='SaveAjax',c.mode='saveSequenceNumber',c.updatedFields=a.updatedBlockFieldsList,AppConnector.request(c).done(function(){b.progressIndicator({mode:'hide'});var a={};a.text=app.vtranslate('JS_MODULES_SEQUENCE_UPDATED'),Settings_Vtiger_Index_Js.showMessage(a);}).fail(function(){b.progressIndicator({mode:'hide'});});},createUpdatedSequenceModulesList:function f(){var a=this,b=jQuery('.SearchFieldsEdit').find('.contents'),c=b.find('tbody'),d=c.find('tr'),e=1;d.each(function(b,c){var d=jQuery(c),f=d.data('tabid');a.updatedBlockFieldsList.push({tabid:f,sequence:e}),++e;});},registerModuleSequenceSaveClick:function c(){var a=this,b=jQuery('.SearchFieldsEdit');b.on('click','.saveModuleSequence',function(){a.hideSaveModuleSequenceButton(),a.createUpdatedSequenceModulesList(),a.updateModulesSequence();});},registerSelectElement:function b(a){a.val();a.hasClass('selectized')||a.selectize({plugins:['drag_drop','remove_button'],onChange:function b(a){1<a.length?jQuery(this.$control[0]).find('.remove').removeClass('d-none'):jQuery(this.$control[0]).find('.remove').addClass('d-none');},onInitialize:function a(){1<this.items.length?jQuery(this.$control[0]).find('.remove').removeClass('d-none'):jQuery(this.$control[0]).find('.remove').addClass('d-none');}});},registerEvents:function a(){Settings_Index_Js.initEvants(),this.makeFieldsListSortable(),this.registerModuleSequenceSaveClick();}};$(document).ready(function(){Settings_Index_Js.registerEvents();});
