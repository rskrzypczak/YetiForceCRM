'use strict';

jQuery.Class('Settings_CurrencyUpdate_Index_Js',{},{registerInfoButton:function b(a){a.find('#supportedCurrencies').on('click',function(){jQuery('#infoBlock').toggleClass('d-none');});},registerAlertButton:function b(a){a.find('#unsupportedCurrencies').on('click',function(){a.find('#alertBlock').toggleClass('d-none');});},registerBankChange:function b(a){a.find('#bank').on('change',function(){bankName=a.find('#bank option:selected').data('name'),a.find('#alertSpan').html(''),a.find('#infoSpan').html('');var b=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),c={};c.data={parent:app.getParentModuleName(),module:app.getModuleName(),action:'GetBankCurrencies',mode:'supported',name:bankName},c.dataType='json',AppConnector.request(c).done(function(b){var c=b.result,d='';for(var e in c)d+='<p><strong>'+e+'</strong> - '+c[e]+'</p>';a.find('#infoSpan').html(d);}),c.data={parent:app.getParentModuleName(),module:app.getModuleName(),action:'GetBankCurrencies',mode:'unsupported',name:bankName},c.dataType='json',AppConnector.request(c).done(function(b){var c=b.result;jQuery.isEmptyObject(c)?(!a.find('#unsupportedCurrencies').hasClass('d-none')&&a.find('#unsupportedCurrencies').addClass('d-none'),!a.find('#alertBlock').hasClass('d-none')&&a.find('#alertBlock').addClass('d-none')):a.find('#unsupportedCurrencies').removeClass('d-none');var d='';for(var e in c)d+='<p><strong>'+e+'</strong> - '+c[e]+'</p>';a.find('#alertSpan').html(d);});var d=jQuery('#bank option:selected').val();c.data={parent:app.getParentModuleName(),module:app.getModuleName(),action:'SaveActiveBank',id:d},c.dataType='json',AppConnector.request(c).done(function(a){var c=a.result;if(c.success){var d={text:c.message,type:'success'};Vtiger_Helper_Js.showPnotify(d);}else{var d={text:c.message,hide:!1,type:'error'};Vtiger_Helper_Js.showPnotify(d);}b.progressIndicator({mode:'hide'});});});},registerEvents:function b(){var a=jQuery('#currencyUpdateContainer');App.Fields.Date.register('#datepicker',!1,{}),this.registerInfoButton(a),this.registerAlertButton(a),this.registerBankChange(a);}});
