'use strict';

function SMSTask(a){function b(a){return function(b,c){b?a(c):errorDialog('Failure:'+c);}}function c(a){for(var b=a.fields,c=0;c<b.length;c++){var d=b[c],e=d.type;'owner'==e.name&&(e.name='reference',e.refersTo=['Users']);}return a}function d(b,c){var d=[];return a.each(c,function(a,c){m(b,c)&&d.push(c);}),d}function e(a,b){if(document.selection){a.focus();var c=document.selection.createRange();c.text=b,a.focus();}else if(a.selectionStart||'0'==a.selectionStart){var d=a.selectionStart,e=a.selectionEnd,f=a.scrollTop;a.value=a.value.substring(0,d)+b+a.value.substring(e,a.value.length),a.focus(),a.selectionStart=d+b.length,a.selectionEnd=d+b.length,a.scrollTop=f;}else a.value+=b,a.focus();}function f(b,c,d,f){function e(a){return j(function(a){var b=!m(['autogenerated','reference','owner','multipicklist','password'],a.type.name),c=f(a);return b&&c},a)}null==f&&(f=function(){return !0});var g=c[d],l=g.fields,o=h(function(a){return [a.name,a.label]},e(g.fields)),p=j(function(a){return 'reference'==a.type.name},g.fields),q={};a.each(c,function(a,b){q[a]=i(h(function(a){return [a.name,a.type]},e(b.fields)));});var r=k(n,h(function(a){var b=a.name,d=a.label;return k(n,h(function(a){return m(accessibleModulesInfo,a)?h(function(c){return ['('+b+' : ('+a+') '+c.name+')',d+' : ('+a+') '+c.label]},e(c[a].fields)):[]},a.type.refersTo),[])},p),[]),s=i(o.concat(r)),t=a('#'+b);a.each(s,function(a,c){t.append('<option class="'+(b+'_option')+'" value="'+a+'">'+c+'</option>');});}function g(e,f,g){o.describeObject(f,b(function(b){var f=c(b),n=f.fields,q=j(function(a){return 'reference'==a.type.name},n),r=h(function(a){return a.type.refersTo},q),s=k(function(c,a){var b=j(function(a){return !m(c,a)},a);return c.concat(b)},r,[f.name]);s=d(e,s);var t=l(function(a){var b=j(function(a){return !1==a[0]},a);if(0!=b.length){var d=b[0];g(!1,d[1]);}else{var e=h(function(a){return c(a[1])},a),f=i(h(function(a){return [a.name,a]},e));g(!0,f);}},s.length);a.each(s,function(a,b){t(function(a){o.describeObject(b,a);});});}));}var h=fn.map,i=fn.dict,j=fn.filter,k=fn.reduceR,l=fn.parallelExecuter,m=fn.contains,n=fn.concat,o=new VtigerWebservices('webservice.php');a(document).ready(function(){o.extendSession(b(function(){o.listTypes(b(function(c){accessibleModulesInfo=c,g(c,moduleName,b(function(b){f('sms_fieldnames',b,moduleName),a('#task-fieldnames-busyicon').hide(),a('#sms_fieldnames').show(),a('#sms_fieldnames').on('change',function(){var b=a('#save_content').get(0),c='$'+a(this).attr('value');e(b,c);}),f('task_phonefields',b,moduleName,function(a){return 'phone'==a.type.name}),a('#task-phonefields-busyicon').hide(),a('#task_phonefields').show(),a('#task_phonefields').on('change',function(){var b=a(a('#save_recepient').get()),c='$'+a(this).attr('value');b.attr('value',b.attr('value')+','+c);});}));}));})),validator.mandatoryFields.push('sms_recepient');});}SMSTask(jQuery);
